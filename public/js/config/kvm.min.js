/**
 ** kvm.js - 一款兼容AMD,CMD,angular模块规范同时支持依赖注入的模块管理器
 ** @author Janry
 ** @version v0.2.2
 **/
!function e(t,r,n){function i(a,u){if(!r[a]){if(!t[a]){var s="function"==typeof require&&require;if(!u&&s)return s(a,!0);if(o)return o(a,!0);throw new Error("Cannot find module '"+a+"'")}var c=r[a]={exports:{}};t[a][0].call(c.exports,function(e){var r=t[a][1][e];return i(r?r:e)},c,c.exports,e,t,r,n)}return r[a].exports}for(var o="function"==typeof require&&require,a=0;a<n.length;a++)i(n[a]);return i}({1:[function(e,t){t.exports={"default":e("core-js/library/fn/object/assign"),__esModule:!0}},{"core-js/library/fn/object/assign":9}],2:[function(e,t){t.exports={"default":e("core-js/library/fn/object/get-own-property-descriptor"),__esModule:!0}},{"core-js/library/fn/object/get-own-property-descriptor":10}],3:[function(e,t){t.exports={"default":e("core-js/library/fn/promise"),__esModule:!0}},{"core-js/library/fn/promise":11}],4:[function(e,t,r){"use strict";r["default"]=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},r.__esModule=!0},{}],5:[function(e,t,r){"use strict";r["default"]=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),r.__esModule=!0},{}],6:[function(e,t,r){"use strict";var n=e("babel-runtime/core-js/object/get-own-property-descriptor")["default"];r["default"]=function(e,t,r){for(var i=!0;i;){s=l=c=void 0,i=!1;var o=e,a=t,u=r,s=n(o,a);if(void 0!==s){if("value"in s)return s.value;var c=s.get;return void 0===c?void 0:c.call(u)}var l=Object.getPrototypeOf(o);if(null===l)return void 0;e=l,t=a,r=u,i=!0}},r.__esModule=!0},{"babel-runtime/core-js/object/get-own-property-descriptor":2}],7:[function(e,t,r){"use strict";r["default"]=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(e.__proto__=t)},r.__esModule=!0},{}],8:[function(e,t,r){"use strict";r["default"]=function(e){return e&&e.__esModule?e:{"default":e}},r.__esModule=!0},{}],9:[function(e,t){e("../../modules/es6.object.assign"),t.exports=e("../../modules/$").core.Object.assign},{"../../modules/$":21,"../../modules/es6.object.assign":29}],10:[function(e,t){e("../../modules/es6.object.statics-accept-primitives"),t.exports=e("../../modules/$").core.Object.getOwnPropertyDescriptor},{"../../modules/$":21,"../../modules/es6.object.statics-accept-primitives":30}],11:[function(e,t){e("../modules/es6.string.iterator"),e("../modules/web.dom.iterable"),e("../modules/es6.promise"),t.exports=e("../modules/$").core.Promise},{"../modules/$":21,"../modules/es6.promise":31,"../modules/es6.string.iterator":32,"../modules/web.dom.iterable":33}],12:[function(e,t){function r(e,t,r){if(!e)throw TypeError(r?t+r:t)}var n=e("./$");r.def=n.assertDefined,r.fn=function(e){if(!n.isFunction(e))throw TypeError(e+" is not a function!");return e},r.obj=function(e){if(!n.isObject(e))throw TypeError(e+" is not an object!");return e},r.inst=function(e,t,r){if(!(e instanceof t))throw TypeError(r+": use the 'new' operator!");return e},t.exports=r},{"./$":21}],13:[function(e,t){var r=e("./$");t.exports=Object.assign||function(e){for(var t=Object(r.assertDefined(e)),n=arguments.length,i=1;n>i;)for(var o,a=r.ES5Object(arguments[i++]),u=r.getKeys(a),s=u.length,c=0;s>c;)t[o=u[c++]]=a[o];return t}},{"./$":21}],14:[function(e,t){function r(e){return o.call(e).slice(8,-1)}var n=e("./$"),i=e("./$.wks")("toStringTag"),o={}.toString;r.classof=function(e){var t,n;return void 0==e?void 0===e?"Undefined":"Null":"string"==typeof(n=(t=Object(e))[i])?n:r(t)},r.set=function(e,t,r){e&&!n.has(e=r?e:e.prototype,i)&&n.hide(e,i,t)},t.exports=r},{"./$":21,"./$.wks":27}],15:[function(e,t){var r=e("./$.assert").fn;t.exports=function(e,t,n){if(r(e),~n&&void 0===t)return e;switch(n){case 1:return function(r){return e.call(t,r)};case 2:return function(r,n){return e.call(t,r,n)};case 3:return function(r,n,i){return e.call(t,r,n,i)}}return function(){return e.apply(t,arguments)}}},{"./$.assert":12}],16:[function(e,t){function r(e,t){return function(){return e.apply(t,arguments)}}function n(e,t,s){var c,l,f,d,h=e&n.G,p=h?o:e&n.S?o[t]:(o[t]||{}).prototype,v=h?a:a[t]||(a[t]={});h&&(s=t);for(c in s)l=!(e&n.F)&&p&&c in p,l&&c in v||(f=l?p[c]:s[c],h&&!u(p[c])?d=s[c]:e&n.B&&l?d=r(f,o):e&n.W&&p[c]==f?!function(e){d=function(t){return this instanceof e?new e(t):e(t)},d.prototype=e.prototype}(f):d=e&n.P&&u(f)?r(Function.call,f):f,i.hide(v,c,d))}var i=e("./$"),o=i.g,a=i.core,u=i.isFunction;n.F=1,n.G=2,n.S=4,n.P=8,n.B=16,n.W=32,t.exports=n},{"./$":21}],17:[function(e,t){t.exports=function(e){return e.FW=!1,e.path=e.core,e}},{}],18:[function(e,t){t.exports=function(e,t,r){var n=void 0===r;switch(t.length){case 0:return n?e():e.call(r);case 1:return n?e(t[0]):e.call(r,t[0]);case 2:return n?e(t[0],t[1]):e.call(r,t[0],t[1]);case 3:return n?e(t[0],t[1],t[2]):e.call(r,t[0],t[1],t[2]);case 4:return n?e(t[0],t[1],t[2],t[3]):e.call(r,t[0],t[1],t[2],t[3]);case 5:return n?e(t[0],t[1],t[2],t[3],t[4]):e.call(r,t[0],t[1],t[2],t[3],t[4])}return e.apply(r,t)}},{}],19:[function(e,t){var r=e("./$.wks")("iterator"),n=!1;try{var i=[7][r]();i["return"]=function(){n=!0},Array.from(i,function(){throw 2})}catch(o){}t.exports=function(e){if(!n)return!1;var t=!1;try{var i=[7],o=i[r]();o.next=function(){t=!0},i[r]=function(){return o},e(i)}catch(a){}return t}},{"./$.wks":27}],20:[function(e,t){"use strict";function r(e,t){u.hide(e,d,t),h in[]&&u.hide(e,h,t)}function n(e,t,n,i){var o=e.prototype,a=o[d]||o[h]||i&&o[i]||n;if(u.FW&&r(o,a),a!==n){var s=u.getProto(a.call(new e));c.set(s,t+" Iterator",!0),u.FW&&u.has(o,h)&&r(s,u.that)}return p[t]=a,p[t+" Iterator"]=u.that,a}function i(e){var t=u.g.Symbol,r=e[t&&t.iterator||h],n=r||e[d]||p[c.classof(e)];return f(n.call(e))}function o(e){var t=e["return"];void 0!==t&&f(t.call(e))}function a(e,t,r,n){try{return n?t(f(r)[0],r[1]):t(r)}catch(i){throw o(e),i}}var u=e("./$"),s=e("./$.ctx"),c=e("./$.cof"),l=e("./$.def"),f=e("./$.assert").obj,d=e("./$.wks")("iterator"),h="@@iterator",p={},v={},g="keys"in[]&&!("next"in[].keys());r(v,u.that);var m=t.exports={BUGGY:g,Iterators:p,prototype:v,step:function(e,t){return{value:t,done:!!e}},stepCall:a,close:o,is:function(e){var t=Object(e),r=u.g.Symbol,n=r&&r.iterator||h;return n in t||d in t||u.has(p,c.classof(t))},get:i,set:r,create:function(e,t,r,n){e.prototype=u.create(n||m.prototype,{next:u.desc(1,r)}),c.set(e,t+" Iterator")},define:n,std:function(e,t,r,i,o,a,s){function c(e){return function(){return new r(this,e)}}m.create(r,t,i);var f,d,h=c("key+value"),p=c("value"),v=e.prototype;if("value"==o?p=n(e,t,p,"values"):h=n(e,t,h,"entries"),o&&(f={entries:h,keys:a?p:c("key"),values:p},l(l.P+l.F*g,t,f),s))for(d in f)d in v||u.hide(v,d,f[d])},forOf:function(e,t,r,n){for(var u,c=i(e),l=s(r,n,t?2:1);!(u=c.next()).done;)if(a(c,l,u.value,t)===!1)return o(c)}}},{"./$":21,"./$.assert":12,"./$.cof":14,"./$.ctx":15,"./$.def":16,"./$.wks":27}],21:[function(e,t){"use strict";function r(e){return isNaN(e=+e)?0:(e>0?p:h)(e)}function n(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}function i(e,t,r){return e[t]=r,e}function o(e){return m?function(t,r,i){return b.setDesc(t,r,n(e,i))}:i}function a(e){return null!==e&&("object"==typeof e||"function"==typeof e)}function u(e){return"function"==typeof e}function s(e){if(void 0==e)throw TypeError("Can't call method on  "+e);return e}var c="undefined"!=typeof self?self:Function("return this")(),l={},f=Object.defineProperty,d={}.hasOwnProperty,h=Math.ceil,p=Math.floor,v=Math.max,g=Math.min,m=!!function(){try{return 2==f({},"a",{get:function(){return 2}}).a}catch(e){}}(),y=o(1),b=t.exports=e("./$.fw")({g:c,core:l,html:c.document&&document.documentElement,isObject:a,isFunction:u,it:function(e){return e},that:function(){return this},toInteger:r,toLength:function(e){return e>0?g(r(e),9007199254740991):0},toIndex:function(e,t){return e=r(e),0>e?v(e+t,0):g(e,t)},has:function(e,t){return d.call(e,t)},create:Object.create,getProto:Object.getPrototypeOf,DESC:m,desc:n,getDesc:Object.getOwnPropertyDescriptor,setDesc:f,getKeys:Object.keys,getNames:Object.getOwnPropertyNames,getSymbols:Object.getOwnPropertySymbols,assertDefined:s,ES5Object:Object,toObject:function(e){return b.ES5Object(s(e))},hide:y,def:o(0),set:c.Symbol?i:y,mix:function(e,t){for(var r in t)y(e,r,t[r]);return e},each:[].forEach});"undefined"!=typeof __e&&(__e=l),"undefined"!=typeof __g&&(__g=c)},{"./$.fw":17}],22:[function(e,t){var r=e("./$");t.exports=function(t){r.DESC&&r.FW&&r.setDesc(t,e("./$.wks")("species"),{configurable:!0,get:r.that})}},{"./$":21,"./$.wks":27}],23:[function(e,t){"use strict";var r=e("./$");t.exports=function(e){return function(t){var n,i,o=String(r.assertDefined(this)),a=r.toInteger(t),u=o.length;return 0>a||a>=u?e?"":void 0:(n=o.charCodeAt(a),55296>n||n>56319||a+1===u||(i=o.charCodeAt(a+1))<56320||i>57343?e?o.charAt(a):n:e?o.slice(a,a+2):(n-55296<<10)+(i-56320)+65536)}}},{"./$":21}],24:[function(e,t){"use strict";function r(){var e=+this;if(u.has(j,e)){var t=j[e];delete j[e],t()}}function n(e){r.call(e.data)}var i,o,a,u=e("./$"),s=e("./$.ctx"),c=e("./$.cof"),l=e("./$.invoke"),f=u.g,d=u.isFunction,h=u.html,p=f.document,v=f.process,g=f.setImmediate,m=f.clearImmediate,y=f.postMessage,b=f.addEventListener,$=f.MessageChannel,E=0,j={},w="onreadystatechange";d(g)&&d(m)||(g=function(e){for(var t=[],r=1;arguments.length>r;)t.push(arguments[r++]);return j[++E]=function(){l(d(e)?e:Function(e),t)},i(E),E},m=function(e){delete j[e]},"process"==c(v)?i=function(e){v.nextTick(s(r,e,1))}:b&&d(y)&&!f.importScripts?(i=function(e){y(e,"*")},b("message",n,!1)):d($)?(o=new $,a=o.port2,o.port1.onmessage=n,i=s(a.postMessage,a,1)):i=p&&w in p.createElement("script")?function(e){h.appendChild(p.createElement("script"))[w]=function(){h.removeChild(this),r.call(e)}}:function(e){setTimeout(s(r,e,1),0)}),t.exports={set:g,clear:m}},{"./$":21,"./$.cof":14,"./$.ctx":15,"./$.invoke":18}],25:[function(e,t){function r(e){return"Symbol("+e+")_"+(++n+Math.random()).toString(36)}var n=0;r.safe=e("./$").g.Symbol||r,t.exports=r},{"./$":21}],26:[function(e,t){var r=e("./$"),n=e("./$.wks")("unscopables");!r.FW||n in[]||r.hide(Array.prototype,n,{}),t.exports=function(e){r.FW&&([][n][e]=!0)}},{"./$":21,"./$.wks":27}],27:[function(e,t){var r=e("./$").g,n={};t.exports=function(t){return n[t]||(n[t]=r.Symbol&&r.Symbol[t]||e("./$.uid").safe("Symbol."+t))}},{"./$":21,"./$.uid":25}],28:[function(e){var t=e("./$"),r=e("./$.unscope"),n=e("./$.uid").safe("iter"),i=e("./$.iter"),o=i.step,a=i.Iterators;i.std(Array,"Array",function(e,r){t.set(this,n,{o:t.toObject(e),i:0,k:r})},function(){var e=this[n],t=e.o,r=e.k,i=e.i++;return!t||i>=t.length?(e.o=void 0,o(1)):"key"==r?o(0,i):"value"==r?o(0,t[i]):o(0,[i,t[i]])},"value"),a.Arguments=a.Array,r("keys"),r("values"),r("entries")},{"./$":21,"./$.iter":20,"./$.uid":25,"./$.unscope":26}],29:[function(e){var t=e("./$.def");t(t.S,"Object",{assign:e("./$.assign")})},{"./$.assign":13,"./$.def":16}],30:[function(e){function t(e,t){var a=(r.core.Object||{})[e]||Object[e],u=0,s={};s[e]=1==t?function(e){return i(e)?a(e):e}:2==t?function(e){return i(e)?a(e):!0}:3==t?function(e){return i(e)?a(e):!1}:4==t?function(e,t){return a(o(e),t)}:5==t?function(e){return a(Object(r.assertDefined(e)))}:function(e){return a(o(e))};try{a("z")}catch(c){u=1}n(n.S+n.F*u,"Object",s)}var r=e("./$"),n=e("./$.def"),i=r.isObject,o=r.toObject;t("freeze",1),t("seal",1),t("preventExtensions",1),t("isFrozen",2),t("isSealed",2),t("isExtensible",3),t("getOwnPropertyDescriptor",4),t("getPrototypeOf",5),t("keys"),t("getOwnPropertyNames")},{"./$":21,"./$.def":16}],31:[function(e){"use strict";function t(e){var t=O(e)[p];return void 0!=t?t:e}function r(e){var t;return _(e)&&(t=e.then),w(t)?t:!1}function n(e){var t,r=e[v],i=r.c,o=0;if(r.h)return!1;for(;i.length>o;)if(t=i[o++],t.fail||!n(t.P))return!1;return!0}function i(e,t){var i=e.c;(t||i.length)&&$(function(){var o=e.p,a=e.v,u=1==e.s,s=0;if(t&&n(o))setTimeout(function(){n(o)&&("process"==l(b)?b.emit("unhandledRejection",a,o):y.console&&w(console.error)&&console.error("Unhandled promise rejection",a))},1e3);else for(;i.length>s;)!function(t){var n,i,o=u?t.ok:t.fail;try{o?(u||(e.h=!0),n=o===!0?a:o(a),n===t.P?t.rej(TypeError(m+"-chain cycle")):(i=r(n))?i.call(n,t.res,t.rej):t.res(n)):t.rej(a)}catch(s){t.rej(s)}}(i[s++]);i.length=0})}function o(e){var t=this;t.d||(t.d=!0,t=t.r||t,t.v=e,t.s=2,i(t,!0))}function a(e){var t,n,u=this;if(!u.d){u.d=!0,u=u.r||u;try{(t=r(e))?(n={r:u,d:!1},t.call(e,c(a,n,1),c(o,n,1))):(u.v=e,u.s=1,i(u))}catch(s){o.call(n||{r:u,d:!1},s)}}}var u,s=e("./$"),c=e("./$.ctx"),l=e("./$.cof"),f=e("./$.def"),d=e("./$.assert"),h=e("./$.iter"),p=e("./$.wks")("species"),v=e("./$.uid").safe("record"),g=h.forOf,m="Promise",y=s.g,b=y.process,$=b&&b.nextTick||e("./$.task").set,E=y[m],j=E,w=s.isFunction,_=s.isObject,k=d.fn,O=d.obj;w(E)&&w(E.resolve)&&E.resolve(u=new E(function(){}))==u||(E=function(e){k(e);var t={p:d.inst(this,E,m),c:[],s:0,d:!1,v:void 0,h:!1};s.hide(this,v,t);try{e(c(a,t,1),c(o,t,1))}catch(r){o.call(t,r)}},s.mix(E.prototype,{then:function(e,t){var r=O(O(this).constructor)[p],n={ok:w(e)?e:!0,fail:w(t)?t:!1},o=n.P=new(void 0!=r?r:E)(function(e,t){n.res=k(e),n.rej=k(t)}),a=this[v];return a.c.push(n),a.s&&i(a),o},"catch":function(e){return this.then(void 0,e)}})),f(f.G+f.W+f.F*(E!=j),{Promise:E}),l.set(E,m),e("./$.species")(E),f(f.S,m,{reject:function(e){return new(t(this))(function(t,r){r(e)})},resolve:function(e){return _(e)&&v in e&&s.getProto(e)===this.prototype?e:new(t(this))(function(t){t(e)})}}),f(f.S+f.F*!e("./$.iter-detect")(function(e){E.all(e)["catch"](function(){})}),m,{all:function(e){var r=t(this),n=[];return new r(function(t,i){g(e,!1,n.push,n);var o=n.length,a=Array(o);o?s.each.call(n,function(e,n){r.resolve(e).then(function(e){a[n]=e,--o||t(a)},i)}):t(a)})},race:function(e){var r=t(this);return new r(function(t,n){g(e,!1,function(e){r.resolve(e).then(t,n)})})}})},{"./$":21,"./$.assert":12,"./$.cof":14,"./$.ctx":15,"./$.def":16,"./$.iter":20,"./$.iter-detect":19,"./$.species":22,"./$.task":24,"./$.uid":25,"./$.wks":27}],32:[function(e){var t=e("./$").set,r=e("./$.string-at")(!0),n=e("./$.uid").safe("iter"),i=e("./$.iter"),o=i.step;i.std(String,"String",function(e){t(this,n,{o:String(e),i:0})},function(){var e,t=this[n],i=t.o,a=t.i;return a>=i.length?o(1):(e=r.call(i,a),t.i+=e.length,o(0,e))})},{"./$":21,"./$.iter":20,"./$.string-at":23,"./$.uid":25}],33:[function(e){e("./es6.array.iterator");var t=e("./$"),r=e("./$.iter").Iterators,n=e("./$.wks")("iterator"),i=r.Array,o=t.g.NodeList;!t.FW||!o||n in o.prototype||t.hide(o.prototype,n,i),r.NodeList=i},{"./$":21,"./$.iter":20,"./$.wks":27,"./es6.array.iterator":28}],34:[function(e,t,r){"use strict";var n=e("babel-runtime/helpers/inherits")["default"],i=e("babel-runtime/helpers/get")["default"],o=e("babel-runtime/helpers/create-class")["default"],a=e("babel-runtime/helpers/class-call-check")["default"],u=e("babel-runtime/core-js/promise")["default"],s=e("babel-runtime/core-js/object/assign")["default"],c=e("babel-runtime/helpers/interop-require-wildcard")["default"];Object.defineProperty(r,"__esModule",{value:!0});var l=e("./utils"),f=c(l),d=e("./emitter"),h=c(d),p=new h["default"],v={baseUrl:"",vars:{},packages:{},alias:{},shims:{},version:""},g={MODULES:{},insert:function(e){var t=e.path,r=e.path.id||e.path.uri,n=y.getDriver(t);return this.MODULES[r]||(this.MODULES[r]=e,n&&n.$emit("loaded",e)),this.MODULES[r]},find:function(e){return this.MODULES[e.id||e.uri]||this.MODULES[e.id]||this.MODULES[e.uri]}},m=function(e){function t(e,r,n){a(this,t),i(Object.getPrototypeOf(t.prototype),"constructor",this).call(this),this.sender=e,this.reqs=f["default"].isArray(r)?r:[r],this.drivers=[],this.results=[],this.callback=n,this._parseReqs(),this.send()}return n(t,e),o(t,[{key:"_createDriver",value:function(e){var t=y.getDriver(e),r=this;if(!t){if(t=new y(e),t.beforeLoad(),t.module)return r._done(t.module);this.drivers.push(t)}return t.module?r._done(t.module):t.$on("loaded",function(e){t.module=e,r._done(e)}),this}},{key:"_parseReqs",value:function(){var e=this,t=void 0;return this.reqs=this.reqs.filter(function(e){return!!e}),this.reqs.length>0?this.reqs.forEach(function(r){t=e.sender.getInjector(r),t=t||r.getModule(),t?e._done(t):e._createDriver(r)}):e.callback([]),this}},{key:"_checkDone",value:function(){return this.reqs.length==this.results.length}},{key:"_done",value:function(e){return this.results.push(e),this._checkDone()&&f["default"].isFunction(this.callback)&&this.callback(this.results),this}},{key:"send",value:function(){return this.drivers.forEach(function(e){e.load()}),this}}],[{key:"fetch",value:function(e,r){return r=f["default"].isArray(r)?r:[r],new u(function(n){new t(e,r,function(e){n(e)})})}}]),t}(h["default"]),y=function(e){function t(e){a(this,t),i(Object.getPrototypeOf(t.prototype),"constructor",this).call(this),this.path=e,this.module=null,t.getDriver(e)||t.addDriver(this)}return n(t,e),o(t,[{key:"beforeLoad",value:function(){p.$emit("DRIVER_BEFORE_LOAD",this)}},{key:"load",value:function(){var e=this.path,t=e.uri;t=f["default"].addQueryString(t,s({version:v.version},e.query)),t=f["default"].addHashString(t,e.hash),"js"!=e.ext?p.$emit("DRIVER_LOADER_"+e.ext.toLocaleUpperCase(),this):this._loadJS(t,this.loaded.bind(this))}},{key:"loaded",value:function(e,t){var r=this.path;"js"!=r.ext?j.define(r.id,function(){return t}):p.$emit("DRIVER_LOADED",this,e,t)}},{key:"_loadJS",value:function(e,t){function r(e,t){function r(r){e.onload=e.onerror=e.onreadystatechange=null,j.data("debug")&&i.removeChild(e),e=null,t&&t(r)}var n="onload"in e;n?(e.onload=r,e.onerror=function(){r(!0)}):e.onreadystatechange=function(){/loaded|complete/.test(e.readyState)&&r()}}var n=document,i=n.head||n.getElementsByTagName("head")[0]||n.documentElement,o=i.getElementsByTagName("base")[0],a=n.createElement("script");a.async=!0,a.src=e,r(a,t),o?i.insertBefore(a,o):i.appendChild(a)}}],[{key:"getDriver",value:function(e){return t.DRIVERS[e.uri]}},{key:"addDriver",value:function(e){t.DRIVERS[e.path.uri]=e}},{key:"registerDriverLoaded",value:function(e){f["default"].isFunction(e)&&p.$on("DRIVER_LOADED",function(t){e.call(t)})}},{key:"registerDriverLoader",value:function(e,t){f["default"].isFunction(t)&&(e=e.trim(),e=e.toUpperCase(),p.$one("DRIVER_LOADER_"+e,function(e){t.call(e,e.path.uri,e.loaded.bind(e))}))}},{key:"registerDriverBeforeLoad",value:function(e){f["default"].isFunction(e)&&p.$on("DRIVER_BEFORE_LOAD",function(t){e.call(t)})}}]),t}(h["default"]);y.DRIVERS={};var b=function(e){function t(e,r){a(this,t),i(Object.getPrototypeOf(t.prototype),"constructor",this).call(this),this.baseUrl=r||v.baseUrl,this.id=e||"",this._initId(),this._maper(),this._parser(),this._initUri()}return n(t,e),o(t,[{key:"_initId",value:function(){if(this.id){var e=this.id;this.query=f["default"].getQuery(e),this.hash=f["default"].getHash(this.id),this.id=this.id.replace(/(#|\?).*/,"")}}},{key:"_initUri",value:function(){this.baseUrl=this.baseUrl.replace(/\/$/,"")+"/",this.uri=this.uri?f["default"].resolvePath(this.baseUrl,this.uri):this.id?f["default"].resolvePath(this.baseUrl,this.id):f["default"].getCurrentScript().uri,this._initExt()}},{key:"_initExt",value:function(){var e=this.uri.match(/\.(\w+)$/);e&&e[1]?(e=e[1].toLocaleLowerCase(),-1!=t.__EXTS__.indexOf(e)?this.ext=e:(this.$emit("FILE_EXTS_PARSER",this),t.__EXTS__.indexOf(this.ext)||(this.ext="js"))):(this.ext="js",this.uri+=".js")}},{key:"_maper",value:function(){this.id&&p.$emit("PATH_MAPER",this)}},{key:"_parser",value:function(){this.id&&(this._parseVars(),p.$emit("PATH_PARSER",this))}},{key:"_parseVars",value:function(){this.baseUrl=this.template(this.baseUrl),this.id=this.template(this.id),this.uri=this.uri?this.template(this.uri):""}},{key:"getModule",value:function(){return g.find(this)}},{key:"equal",value:function(e){return this.id&&this.id==e.id||this.uri&&this.uri==e.uri}},{key:"getMap",value:function(e){var t=null,r=this;if(f["default"].isArray(e))e.forEach(function(e){return e.equal&&e.equal(r)||e.path&&e.path.equal(r)?(t=e,!1):void 0});else if(f["default"].isObject(e))return e&&e[this.id||this.uri];return t}},{key:"template",value:function(e){if(!f["default"].isString(e))throw new Error("路径类型错误");var t=/\{([^{}]+)\}/g,r=void 0,n=this;return r=e.replace(t,function(e,t){return v.vars&&v.vars[t]?v.vars[t]:t}),t.test(r)?n.template(r):r}}],[{key:"registerFileExtParser",value:function(e){f["default"].isFunction(e)&&p.$on("FILE_EXTS_PARSER",function(t){e.call(t)})}},{key:"registerPathParser",value:function(e){f["default"].isFunction(e)&&p.$on("PATH_PARSER",function(t){e.call(t)})}},{key:"registerPathMaper",value:function(e){f["default"].isFunction(e)&&p.$on("PATH_MAPER",function(t){e.call(t)})}},{key:"createPath",value:function(e,r){return new t(e,r)}}]),t}(h["default"]);b.__EXTS__=["js","css","json","jsonp","tpl","html"];var $=function(e){function t(e){a(this,t),i(Object.getPrototypeOf(t.prototype),"constructor",this).call(this),f["default"].options(this,{path:null,depPaths:[],factory:null,injectors:{},installed:!1,module:{exports:null}},e),p.$emit("MODULE_PARSER",this)}return n(t,e),o(t,[{key:"getInjector",value:function(e){var r=this.injectors[e.id];return r?t.createModule(e.id,r):void 0}},{key:"invoke",value:function(){var e=this;return new u(function(t){if(e.installed)t(u.resolve(e.module.exports));else if(e.factory)t(u.resolve(e._inject()));else{if(!e.path||e.factory)throw new Error("模块不符合规范!");t(m.fetch(e,e.path).then(function(e){return u.resolve(e[0]._inject())}))}})}},{key:"_collectDeps",value:function(){var e=this,t=[],r=void 0;return m.fetch(this,this.depPaths).then(function(n){return new u(function(i){e.depPaths.length>0?e.depPaths.forEach(function(o,a){r=o.getMap(n),r&&(t[a]=r.invoke(),t.length==e.depPaths.length&&i(u.all(t)))}):i(u.all([]))})})}},{key:"_inject",value:function(){var e=this;return this._collectDeps().then(function(t){var r=e.factory.apply(null,t);return e.module.exports?r=e.module.exports:e.module.exports=r,e.installed=!0,r})}}],[{key:"createModule",value:function(){for(var e=arguments.length,r=Array(e),n=0;e>n;n++)r[n]=arguments[n];return new t(t.parseMeta.apply(null,r))}},{key:"parseMeta",value:function(){for(var e=arguments.length,t=Array(e),r=0;e>r;r++)t[r]=arguments[r];var n={},i=!1;return f["default"].isBoolean(t[0])&&(i=t[0],t=t.slice(1)),t.forEach(function(e){f["default"].isFunction(e)?n.factory=e:f["default"].isArray(e)?f["default"].isFunction(e[e.length-1])?(n.factory=e[e.length-1],n.depPaths=e.slice(0,e.length-1).map(function(e){return new b(e)})):n.depPaths=e.map(function(e){return new b(e)}):f["default"].isString(e)?n.path=new b(e):f["default"].isObject(e)&&(n.injectors=e)}),!n.path&&i&&(n.path=new b),n}},{key:"registerModuleParser",value:function(e){f["default"].isFunction(e)&&p.$on("MODULE_PARSER",function(t){e.call(t)})}}]),t}(h["default"]),E={registerModuleParser:$.registerModuleParser,registerDriverLoader:y.registerDriverLoader,registerDriverLoaded:y.registerDriverLoaded,registerDriverBeforeLoad:y.registerDriverBeforeLoad,registerFileExtParser:b.registerFileExtParser,registerPathParser:b.registerPathParser,registerPathMaper:b.registerPathMaper,createModule:$.createModule,createPath:b.createPath},j={config:function(e){f["default"].options(v,e)},data:function(e){return v[e]?v[e]:v},define:function(){for(var e=arguments.length,t=Array(e),r=0;e>r;r++)t[r]=arguments[r];return g.insert($.createModule.apply(null,[!0].concat(t))),this},invoke:function(){for(var e=arguments.length,t=Array(e),r=0;e>r;r++)t[r]=arguments[r];return $.createModule.apply(null,t).invoke()},use:function(e,t){var r=$.createModule(e);r.invoke(function(e){f["default"].isFunction(t)&&t(e)})["catch"](function(e){throw e})},registerPlugin:function(e){f["default"].isFunction(e)&&e.call(this,E)}};r["default"]=j,t.exports=r["default"]},{"./emitter":35,"./utils":37,"babel-runtime/core-js/object/assign":1,"babel-runtime/core-js/promise":3,"babel-runtime/helpers/class-call-check":4,"babel-runtime/helpers/create-class":5,"babel-runtime/helpers/get":6,"babel-runtime/helpers/inherits":7,"babel-runtime/helpers/interop-require-wildcard":8}],35:[function(e,t,r){"use strict";var n=e("babel-runtime/helpers/create-class")["default"],i=e("babel-runtime/helpers/class-call-check")["default"],o=e("babel-runtime/helpers/interop-require-wildcard")["default"];Object.defineProperty(r,"__esModule",{value:!0});var a=e("./utils"),u=o(a),s=function(){function e(t){i(this,e),this.$$EVENTS=t?t:{}}return n(e,[{key:"$on",value:function(e,t){var r=this;return e.split(",").forEach(function(e){u["default"].isFunction(t)&&(r.$$EVENTS[e]&&u["default"].isArray(r.$$EVENTS[e])?r.$$EVENTS[e].push(t):r.$$EVENTS[e]=[t])}),this}},{key:"$one",value:function(e,t){var r=this;return e.split(",").forEach(function(e){u["default"].isFunction(t)&&(r.$$EVENTS[e]||(r.$$EVENTS[e]=[t]))}),this}},{key:"$emit",value:function(e){for(var t=arguments.length,r=Array(t>1?t-1:0),n=1;t>n;n++)r[n-1]=arguments[n];var i=this.$$EVENTS[e];if(i&&u["default"].isArray(i))for(var o=0;o<i.length;o++)i[o].apply(null,r);return this}},{key:"$remove",value:function(e,t){var r=this.$$EVENTS[e];if(r&&u["default"].isArray(r))if(t)for(var n=r.length-1;n>=0;n--)t===r[n]&&r.splice(n,1);else delete this.$$EVENTS[e];return this}}]),e}();r["default"]=s,t.exports=r["default"]},{"./utils":37,"babel-runtime/helpers/class-call-check":4,"babel-runtime/helpers/create-class":5,"babel-runtime/helpers/interop-require-wildcard":8}],36:[function(e){"use strict";var t=e("babel-runtime/core-js/object/assign")["default"],r=e("babel-runtime/helpers/interop-require-wildcard")["default"],n=e("./utils"),i=r(n),o=e("./emitter"),a=r(o),u=e("./core"),s=r(u),c={};window.kvm=window.KVM=c,window.kvm.Module=window.kvm.module=s["default"],s["default"].define.amd=!0,window.define=s["default"].define,t(c,i["default"]),s["default"].define("$emitter",function(){return a["default"]})},{"./core":34,"./emitter":35,"./utils":37,"babel-runtime/core-js/object/assign":1,"babel-runtime/helpers/interop-require-wildcard":8}],37:[function(e,t,r){"use strict";var n=e("babel-runtime/core-js/object/assign")["default"];Object.defineProperty(r,"__esModule",{value:!0});var i=Object.prototype.hasOwnProperty,o="Function,String,Array,Object,Number,Boolean".split(","),u={isReference:function(e){return this.isArray(e)||this.isObject(e)},isValue:function(e){return!this.isReference(e)},isEmpty:function(e){if(null==e)return!0;if(e.length>0)return!1;if(0===e.length)return!0;for(var t in e)if(i.call(e,t))return!1;return!0},options:function(){for(var e=arguments.length,t=Array(e),r=0;e>r;r++)t[r]=arguments[r];return n.apply(Object,t)},addQueryString:function(e,t){var r=document.createElement("a"),n="?",i=void 0;r.href=e.replace("?","");for(i in t)t.hasOwnProperty(i)&&t[i]&&(n+=""+i+"="+t[i]+"&");return r.search=n.replace(/&$/,""),r.toString()},getQuery:function(e){var t=document.createElement("a");return t.href=e,this.resolveQuery(t.search)},getHash:function(e){var t=document.createElement("a");return t.href=e,t.hash.replace(/^#/,"")},addHashString:function(e,t){var r=document.createElement("a");return r.href=e,r.hash="#"+t.replace(/^#/,""),r.toString()},resolveQuery:function(e){for(var t=e.replace("?","").split("&"),r={},n=0;n<t.length;n++)if(t[n]){var i=t[n].split("=");r[decodeURIComponent(i[0])]=decodeURIComponent(i[1])}return r},isAbsolutePath:function(e){var t=new RegExp("^(?:[a-z]+:)?//","i");return t.test(e)},resolvePath:function(){for(var e=arguments.length,t=Array(e),r=0;e>r;r++)t[r]=arguments[r];var n=t.length;if(0===n)throw new Error("resolveUrl requires at least one argument; got none.");var i=document.createElement("base");if(i.href=t[0],1===n)return i.href;var o=document.getElementsByTagName("head")[0];o.insertBefore(i,o.firstChild);for(var a=document.createElement("a"),u="",s=1;n>s;s++)a.href=t[s],u=a.href,i.href=u;return o.removeChild(i),u},before:function(e,t,r){var n;e=e||window,n=e[t],e[t]=function(){for(var t=arguments.length,i=Array(t),o=0;t>o;o++)i[o]=arguments[o];var a=r.apply(e,i);return i.push(a),n.apply(e,i),a}},after:function(e,t,r){var n;e=e||window,n=e[t],e[t]=function(){for(var t=arguments.length,i=Array(t),o=0;t>o;o++)i[o]=arguments[o];var a=n.apply(e,i);return i.push(a),r.apply(e,i)}},getCurrentScript:function(){var e=function(){var e=document,t=e.head||e.getElementsByTagName("head")[0]||e.documentElement;if(e.currentScript)return e.currentScript.src;var r=void 0;try{a.b.c()}catch(n){r=n.stack,!r&&window.opera&&(r=(String(n).match(/of linked script \S+/g)||[]).join(" "))}if(r)return r=r.split(/[@ ]/g).pop(),r="("==r[0]?r.slice(1,-1):r,r.replace(/(:\d+)?:\d+$/i,"");for(var i=t.getElementsByTagName("script"),o=0,u=void 0;u=i[o++];)if("interactive"===u.readyState)return u.className=u.src}();return{uri:e.replace(/(#|\?).*/,""),query:this.getQuery(e),hash:this.getHash(e)}}};o.forEach(function(e){return u["is"+e]=function(t){return Object.prototype.toString.call(t)==="[object "+e+"]"}}),r["default"]=u,t.exports=r["default"]},{"babel-runtime/core-js/object/assign":1}]},{},[36]);