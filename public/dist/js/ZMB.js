function bannerRun(a,b,c,d,e){this.$oParent=a,this.$oParent.data("anim")||"no"==this.$oParent.data("anim")||(this.$btnPre=c,this.$btnNext=d,this.$btnNum=e,this.defaultSign=1,this.hoverfn=b,this.aLi=this.$oParent.find("li"),this.length=this.aLi.length,this.index=0,this.zIndex=1,this.autoScoll(),this.addEvent())}bannerRun.prototype={constructor:bannerRun,version:"1.0.0",oLeft:["20px","-20px"],autoScoll:function(){var a=this;this.$oParent.timer=setInterval($.proxy(a.runPic,a),4e3)},runPic:function(a){var b=this,c=this.aLi,d=this.length,e=this.index,f=this.oLeft[e%2],g="number"==typeof a?a:d>e+1?e+1:0;this.removeEvent(),c.eq(e).css({"z-index":1,"margin-left":0,left:0}).animate({opacity:0},1500),this.numAli&&this.numAli.removeClass("active").eq(g).addClass("active"),c.eq(g).css({"z-index":10,left:f,"margin-left":0}).animate({opacity:1,left:0},1500,function(){null==b.$oParent.timer&&(b.$oParent.timer=setInterval($.proxy(b.runPic,b),4e3)),b.addEvent()}),this.index=g},addEvent:function(){var a=this;null!=this.$btnPre&&this.$btnPre.on("click",$.proxy(a.preEvent,a)),null!=this.$btnNext&&this.$btnNext.on("click",$.proxy(a.nextEvent,a)),this.$btnNum&&(this.numAli=this.$btnNum.find("li"),this.numAli.on("click",function(b){b.preventDefault(),b.stopPropagation(),a.$oParent.timer&&(clearInterval(a.$oParent.timer),a.$oParent.timer=null);var c=$(this).index();a.runPic.call(a,c)}))},removeEvent:function(){null!=this.$btnPre&&this.$btnPre.off("click"),null!=this.$btnNext&&this.$btnNext.off("click"),this.$btnNum&&this.numAli.off("click")},preEvent:function(){var a=this;this.$oParent.timer&&(clearInterval(this.$oParent.timer),this.$oParent.timer=null);var b=this.index,c=0>b-1?this.aLi.length-1:b-1;this.runPic.call(a,c)},nextEvent:function(){var a=this;this.$oParent.timer&&(clearInterval(this.$oParent.timer),this.$oParent.timer=null);var b=this.index,c=b+1<this.aLi.length?b+1:this.aLi.length-1;this.runPic.call(a,c)},numToPic:function(){}},$(document).ready(function(){$("#main .content").css("height",$(window).height()-$("#header").height()+"px"),$.each($(".scoll-pic"),function(a,b){new bannerRun($(b),function(){},null,null,$(".sroll-num"))}),$(".add-sign").on("click",function(a){a.preventDefault();var b=$(this).data("name"),c=$('<span class="can-edit" data-name="'+b+'"><input type="text" class="just-create" name="'+b+'" placeholder="写点什么。。。"/></span>');$(this).before(c),c.find("input").focus()}),$("#main").find("input.alive-input").on("click",function(){var a=($(this).attr("name"),$(this).val());$(this).data("val",a)}),$("#main").find("input.alive-input").on("keydown",function(){var a=$(this),b=a.val(),c=b.length;c>=50&&(c=50),a.val(b.substr(0,50)),a.next().find("strong").text(c)}),$("#main").find("input.alive-input").on("change",function(){var a=$(this).attr("name"),b=$(this).val(),c=$(this).data("val"),d=$("#_id").val();return""==b?$(this).val(c):("tilte"==a?$(".house-title").text(b):"summary"==a&&$(".house-summary").text(b),void $.ajax({url:"/updateMessage",type:"post",data:"_id="+d+"&key="+a+"&val="+b,success:function(a){},error:function(a){}}))}),$("#main").delegate("input.just-create","blur",function(){var a=$(this).attr("name"),b=$(this).val(),c=$("#_id").val(),d=$("#config_id").val(),e=[];""==b?$(this).parent().remove():$(this).parent().html(b);for(var f=$("span[data-name="+a+"]"),g=0,h=f.length;h>g;g++)e.push($.trim(f.eq(g).text()));$.ajax({url:"/updateMessage",type:"post",data:"_id="+c+"&key="+a+"&val="+e+"&config_id="+d,success:function(a){}})}),$("#main").delegate(".can-edit","dblclick",function(a){var b=$.trim($(this).text()),c=$(this).data("name"),d=$('<span class="can-edit" data-name="'+c+'"><input type="text" class="just-create" name="'+c+'" data-val="'+b+'" placeholder="写点什么。。。" value="'+b+'"/></span>');$(this).replaceWith(d),d.find("input").focus()}),$("#e2").show(),$("#e1").hide(),$(".map-title").find("li").hover(function(){$(this).attr("class","active").siblings().removeClass("active"),0==$(this).index()?($("#e2").show(),$("#e1").hide(),$(".map-btn").hide()):($("#e2").hide(),$("#e1").show(),$(".map-btn").show())}),$(".pic-show").find("a").on("click",function(a){a.preventDefault();var b=$(this).data("name");$(this).parents(".pic-show").find("a").css("border","1px solid #d6d6d6").removeClass("alive-img"),$(this).css("border","1px solid #6ed16e").addClass("alive-img"),$("#changeType").val(b)}),$('input[type="file"]').on("change",function(){var a=$(this).val().split("\\"),b=$("#_id").val(),c=$(".pic-show").find(".alive-img");if(0==c.length)return console.log("no change");c.css("background",'url("/image/load.gif") no-repeat center').find("input").val("1"),$(this).parents("form").submit();var d=setInterval(function(){var e=new Image;e.src="/image/"+b+"/"+a[a.length-1],e.onload=function(){c.css("background","none").find("img").attr("src","/image/"+b+"/"+a[a.length-1]).addClass("has-img"),c.find("input").val("/image/"+b+"/"+a[a.length-1]),clearInterval(d),d=null},e.error=function(){clearInterval(d),d=null}},500)}),$(".dele").on("click",function(){var a=$(".pic-show").find(".alive-img"),b=$("#changeType").val();if(0!=a.length){var c=$("#_id").val();if(""!=a.find("img").attr("src")){a.find("img").attr("src","").next().val("");for(var d=$(".pic-show").find("input[name="+b+"]"),e=[],f=0,g=d.length;g>f;f++)e.push(d.eq(f).val());$.ajax({url:"/updateMessage",type:"post",data:"_id="+c+"&key="+b+"&val="+e,success:function(a){}})}}}),$(".thumbnail").hover(function(a){a.stopPropagation(),$(this).find(".mask-icon").animate({opacity:1,top:0},200)},function(a){a.stopPropagation(),$(this).find(".mask-icon").animate({opacity:0,top:"-40px"},200)}),$("#under,#dele,#release").on("click",function(a){var b,c=$("#_id").val(),d=$(this).text();b="发布"==d?"2":"下架"==d?"1":"3",$.ajax({url:"/changeStatus",data:"val="+b+"&_id="+c,type:"post",success:function(a){window.location.reload()}})}),$("#btn-login").on("click",function(a){a.preventDefault();var b=$('input[name="username"]').val(),c=$('input[name="password"]').val(),d=$("#error"),e=($(this),$("#managerForm"));return""==b?d.text("账号不能为空").show():""==c?d.text("密码不能为空").show():void $.ajax({url:"/UsernameIsOnly",type:"post",data:"username="+b,success:function(a){return"yes"!=a?d.text("不存在此用户").show():void e.submit()},error:function(a){}})}),$("#open-turn").on("click",function(a){a.preventDefault();var b=$(this).find(".page-choose");b.hasClass("fadeInUp")?b.removeClass("fadeInUp animated-login").hide():b.addClass("fadeInUp animated-login").show()}),$("#open-turn .page-choose").on("click",function(a){return a.stopPropagation(),!1}),$("#turn-page").on("click",function(a){a.preventDefault();var b=$(this).parent(),c=b.find('input[name="page"]').val(),d=b.find('input[name="all"]').val();c>d?alert("超过总数,最多只有"+d):window.location.href="aptManager?count="+c})});