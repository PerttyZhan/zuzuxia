define(["require"],function(require){var a=require("ZMB-clickList"),b=require("mapInit"),c=$("#main");$(document.body).on("click","[data-action]",function(b){var c=$(b.target),d=c.data("action"),e=a[d];void 0!=d&&b.preventDefault(),$.isFunction(e)&&e(c)}),$(".pic-show").find("a").on("click",function(a){var b=$(this).data("name");$(this).parents(".pic-show").find("a").css("border","1px solid #d6d6d6").removeClass("alive-img"),$(this).css("border","1px solid #6ed16e").addClass("alive-img"),$("#changeType").val(b)}),$("#e2").hide(),$("#e1").show(),$(".map-btn").show(),$(".map-title").find("li").hover(function(){$(this).attr("class","active").siblings().removeClass("active"),0==$(this).index()?($("#e2").show(),$("#e1").hide(),$(".map-btn").hide()):($("#e2").hide(),$("#e1").show(),$(".map-btn").show())}),b.Bmap.init("e1"),b.tengMap.init("e2"),c.find("input.alive-input").on("keydown",function(){var a=$(this),b=a.val(),c=b.length;c>=50&&(c=50),a.val(b.substr(0,50)),a.next().find("strong").text(c)}),c.find("input.alive-input").on("change",function(){var a=$(this),b=a.attr("name"),c=a.val(),d=a.data("val"),e=$("#_id").val();return""==c?$(this).val(d):("tilte"==b?$(".house-title").text(c):"summary"==b&&$(".house-summary").text(c),void $.ajax({url:"/updateMessage",type:"post",data:"_id="+e+"&key="+b+"&val="+c,success:function(b){a.data("val",c)},error:function(a){}}))}),c.delegate("input.just-create","blur",function(){var a=$(this).attr("name"),b=$(this).val(),c=$("#_id").val(),d=$("#config_id").val(),e=[];""==b?$(this).parent().remove():$(this).parent().html(b);for(var f=$("span[data-name="+a+"]"),g=0,h=f.length;h>g;g++)e.push($.trim(f.eq(g).text()));$.ajax({url:"/updateMessage",type:"post",data:"_id="+c+"&key="+a+"&val="+e+"&config_id="+d,success:function(a){}})}),c.delegate(".can-edit","dblclick",function(a){var b=$.trim($(this).text()),c=$(this).data("name"),d=$('<span class="can-edit" data-name="'+c+'"><input type="text" class="just-create" name="'+c+'" data-val="'+b+'" placeholder="写点什么。。。" value="'+b+'"/></span>');$(this).replaceWith(d),d.find("input").focus()}),$('input[type="file"]').on("change",function(){var a=$(this).val().split("\\"),b=$("#_id").val(),c=$(".pic-show").find(".alive-img");0==c.length&&alert("需要先选中对象"),c.css("background",'url("/image/load.gif") no-repeat center').find("input").val("1"),$(this).parents("form").submit();var d=setInterval(function(){var e=new Image;e.src="/image/"+b+"/"+a[a.length-1],e.onload=function(){c.css("background","none").find("img").attr("src","/image/"+b+"/"+a[a.length-1]).addClass("has-img"),c.find("input").val("/image/"+b+"/"+a[a.length-1]),clearInterval(d),d=null},e.error=function(){clearInterval(d),d=null}},500)})});